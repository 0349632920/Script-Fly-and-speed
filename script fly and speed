-- StarterPlayerScripts/FiniteJumpOnly.client.lua
-- Finite Jump (không phải inf jump): nhảy thêm tối đa N lần khi đang ở trên không.

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer

local enabled = true
local maxAirJumps = 2      -- chỉnh số lần nhảy thêm (double-jump = 1)
local jumpBoost = 55       -- lực nhảy thêm (10..200)

local usedAirJumps = 0

local function getChar() return player.Character or player.CharacterAdded:Wait() end
local function getHumanoid() return getChar():WaitForChild("Humanoid") end
local function getHRP() return getChar():WaitForChild("HumanoidRootPart") end

local function isGrounded(hum)
	local st = hum:GetState()
	return st == Enum.HumanoidStateType.Running
		or st == Enum.HumanoidStateType.RunningNoPhysics
		or st == Enum.HumanoidStateType.Landed
end

local function hookReset()
	local hum = getHumanoid()
	hum.StateChanged:Connect(function(_, newState)
		if newState == Enum.HumanoidStateType.Landed
			or newState == Enum.HumanoidStateType.Running
			or newState == Enum.HumanoidStateType.RunningNoPhysics then
			usedAirJumps = 0
		end
	end)
end

hookReset()
player.CharacterAdded:Connect(function()
	usedAirJumps = 0
	task.wait(0.1)
	hookReset()
end)

UserInputService.InputBegan:Connect(function(input, gp)
	if gp then return end
	if not enabled then return end
	if input.KeyCode ~= Enum.KeyCode.Space then return end

	local hum = getHumanoid()
	local hrp = getHRP()

	-- đứng đất: cho nhảy bình thường + reset
	if isGrounded(hum) then
		usedAirJumps = 0
		return
	end

	-- trên không: nhảy thêm có giới hạn
	if usedAirJumps >= maxAirJumps then return end
	usedAirJumps += 1

	local v = hrp.AssemblyLinearVelocity
	hrp.AssemblyLinearVelocity = Vector3.new(v.X, math.max(v.Y, jumpBoost), v.Z)
end)

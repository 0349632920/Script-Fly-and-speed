-- ServerScriptService/AdminToolsServer.server.lua
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local DataStoreService = game:GetService("DataStoreService")

local ADMIN_USERIDS = {
	7917510207, -- đổi userId admin
}

local function isAdmin(plr: Player)
	for _, id in ipairs(ADMIN_USERIDS) do
		if plr.UserId == id then return true end
	end
	return false
end

-- Remotes
local folder = ReplicatedStorage:FindFirstChild("AdminTools") or Instance.new("Folder", ReplicatedStorage)
folder.Name = "AdminTools"
local remote = folder:FindFirstChild("AdminAction") or Instance.new("RemoteEvent", folder)
remote.Name = "AdminAction"

-- Save settings per admin (optional)
local store = DataStoreService:GetDataStore("AdminToolsSettings_v1")

local function getChar(plr) return plr.Character end
local function getHum(plr)
	local c = getChar(plr)
	return c and c:FindFirstChildOfClass("Humanoid")
end
local function getHRP(plr)
	local c = getChar(plr)
	return c and c:FindFirstChild("HumanoidRootPart")
end

remote.OnServerEvent:Connect(function(plr, action, data)
	if not isAdmin(plr) then return end
	data = data or {}

	if action == "TP_TO_PLAYER" then
		local targetName = data.targetName
		local target = targetName and Players:FindFirstChild(targetName)
		if not target then return end
		local a = getHRP(plr)
		local b = getHRP(target)
		if a and b then
			a.CFrame = b.CFrame + Vector3.new(0, 5, 0)
		end

	elseif action == "TP_SPAWN" then
		local spawn = workspace:FindFirstChildOfClass("SpawnLocation")
		local a = getHRP(plr)
		if spawn and a then a.CFrame = spawn.CFrame + Vector3.new(0, 5, 0) end

	elseif action == "TP_SAFEZONE" then
		local safe = workspace:FindFirstChild("SafeZone")
		local a = getHRP(plr)
		if safe and safe:IsA("BasePart") and a then
			a.CFrame = safe.CFrame + Vector3.new(0, 5, 0)
		end

	elseif action == "HEAL" then
		local h = getHum(plr)
		if h then h.Health = h.MaxHealth end

	elseif action == "RESET" then
		local h = getHum(plr)
		if h then h.Health = 0 end

	elseif action == "SET_WALK_SPEED" then
		local h = getHum(plr)
		local sp = tonumber(data.walkSpeed)
		if h and sp then
			h.WalkSpeed = math.clamp(sp, 16, 200)
		end

	elseif action == "SAVE_SETTINGS" then
		local ok = pcall(function()
			store:SetAsync(tostring(plr.UserId), data)
		end)
		remote:FireClient(plr, "SAVE_RESULT", { ok = ok })

	elseif action == "LOAD_SETTINGS" then
		local saved
		pcall(function()
			saved = store:GetAsync(tostring(plr.UserId))
		end)
		remote:FireClient(plr, "LOAD_RESULT", saved or {})
	end
end)

-- StarterPlayerScripts/LegitTools_NoKey_AdminSafe_FULL.client.lua
-- 1 LocalScript: NO KEY + (-/X) + 2 panels
-- Fly + Speed<=200 + Inf/Finite Jump + AntiRagdoll + AntiFall + Training(SafeZone)
-- + Admin SAFE tools: Teleport Spawn/SafeZone, Heal, Reset, Gravity, Freeze/Unfreeze (local)

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local StarterGui = game:GetService("StarterGui")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- ===== CONFIG =====
local ADMIN_USERIDS = {7917510207
	-- ðŸ‘‡ THAY userId cá»§a báº¡n vÃ o Ä‘Ã¢y
	-- VÃ­ dá»¥: 123456789
}

local WALK_MIN, WALK_MAX, WALK_STEP = 16, 200, 10
local FLY_MIN,  FLY_MAX,  FLY_STEP  = 20, 200, 10
local FIN_MAX_LIMIT = 10
local FIN_BOOST_LIMIT = 200

-- ===== HELPERS =====
local function notify(title, text, seconds)
	pcall(function()
		StarterGui:SetCore("SendNotification", {
			Title = title or "INFO",
			Text = text or "",
			Duration = seconds or 3
		})
	end)
end

local function isAdmin()
	for _, id in ipairs(ADMIN_USERIDS) do
		if player.UserId == id then return true end
	end
	return false
end

local function clamp(n,a,b) return math.max(a, math.min(b,n)) end
local function getChar() return player.Character or player.CharacterAdded:Wait() end
local function getHumanoid() return getChar():WaitForChild("Humanoid") end
local function getHRP() return getChar():WaitForChild("HumanoidRootPart") end

local function mk(className, props, parent)
	local o = Instance.new(className)
	for k,v in pairs(props) do o[k]=v end
	o.Parent = parent
	return o
end

-- ===== UI STYLE =====
local function styleFrame(f)
	f.BackgroundColor3 = Color3.fromRGB(25,25,25)
	f.BackgroundTransparency = 0.12
	local c = Instance.new("UICorner", f)
	c.CornerRadius = UDim.new(0, 14)
end

local function styleText(t)
	t.TextColor3 = Color3.fromRGB(255,255,255)
	t.TextWrapped = true
	if t:IsA("TextLabel") then
		t.BackgroundTransparency = 1
	else
		t.BackgroundColor3 = Color3.fromRGB(45,45,45)
		t.BackgroundTransparency = 0.08
		t.AutoButtonColor = true
		local c = Instance.new("UICorner", t)
		c.CornerRadius = UDim.new(0, 10)
	end
end

local function mkUI(className, props, parent)
	local o = mk(className, props, parent)
	if className == "Frame" then
		styleFrame(o)
	elseif className == "TextLabel" or className == "TextButton" or className == "TextBox" then
		styleText(o)
		if className == "TextBox" then
			o.PlaceholderColor3 = Color3.fromRGB(180,180,180)
			o.ClearTextOnFocus = false
			o.BackgroundTransparency = 0.05
		end
	end
	return o
end

-- ===== WINDOW BAR (-/X) =====
local function addWindowBar(frame, titleText)
	local bar = mkUI("Frame", {
		Size = UDim2.new(1, -12, 0, 30),
		Position = UDim2.new(0, 6, 0, 6),
	}, frame)
	bar.BackgroundTransparency = 0.2

	mkUI("TextLabel", {
		Size = UDim2.new(1, -90, 1, 0),
		Position = UDim2.new(0, 8, 0, 0),
		TextScaled = true,
		TextXAlignment = Enum.TextXAlignment.Left,
		Text = titleText or "PANEL"
	}, bar)

	local minBtn = mkUI("TextButton", {
		Size = UDim2.new(0, 34, 0, 24),
		Position = UDim2.new(1, -74, 0, 3),
		TextScaled = true,
		Text = "-"
	}, bar)

	local closeBtn = mkUI("TextButton", {
		Size = UDim2.new(0, 34, 0, 24),
		Position = UDim2.new(1, -36, 0, 3),
		TextScaled = true,
		Text = "X"
	}, bar)

	local minimized = false
	minBtn.MouseButton1Click:Connect(function()
		minimized = not minimized
		for _, ch in ipairs(frame:GetChildren()) do
			if ch ~= bar and ch.Name ~= "UICorner" and ch.Name ~= "UIStroke" then
				ch.Visible = not minimized
			end
		end
		minBtn.Text = minimized and "+" or "-"
	end)

	closeBtn.MouseButton1Click:Connect(function()
		frame.Visible = false
	end)

	return bar
end

-- ===== CLEAN OLD =====
local old = playerGui:FindFirstChild("LegitToolsGUI")
if old then old:Destroy() end
local gui = mk("ScreenGui", {Name="LegitToolsGUI", ResetOnSpawn=false}, playerGui)

-- ===== STATE =====
local flyEnabled = false
local walkSpeed = 16
local flySpeed = 60
local bv, bg, flyConn

local infJump = false
local finEnabled = false
local finMaxAir = 2
local finBoost = 55
local usedAir = 0
local lastSpaceAt = 0

local antiRagdoll = false
local antiRagConn
local antiFall = false
local antiFallConn
local trainingEnabled = false
local trainingConn

-- admin local-only
local freezeMe = false
local freezeConn

local leftPanel, rightPanel
local infToggle, finToggle, finMaxLbl, finBoostLbl
local flyBtn, speedLbl, flySpeedLbl, antiRagBtn, antiFallBtn, trainingBtn

local function isGrounded(hum)
	local st = hum:GetState()
	return st == Enum.HumanoidStateType.Running
		or st == Enum.HumanoidStateType.RunningNoPhysics
		or st == Enum.HumanoidStateType.Landed
end

local function applyWalkSpeed()
	getHumanoid().WalkSpeed = walkSpeed
end

-- ===== FLY =====
local function stopFly()
	if not flyEnabled then return end
	flyEnabled = false
	if flyConn then flyConn:Disconnect() flyConn=nil end
	if bv then bv:Destroy() bv=nil end
	if bg then bg:Destroy() bg=nil end
end

local function startFly()
	if flyEnabled then return end
	flyEnabled = true

	local hrp = getHRP()
	bv = Instance.new("BodyVelocity")
	bv.MaxForce = Vector3.new(1e9,1e9,1e9)
	bv.Velocity = Vector3.zero
	bv.Parent = hrp

	bg = Instance.new("BodyGyro")
	bg.MaxTorque = Vector3.new(1e9,1e9,1e9)
	bg.P = 9e4
	bg.CFrame = hrp.CFrame
	bg.Parent = hrp

	flyConn = RunService.RenderStepped:Connect(function()
		local cam = workspace.CurrentCamera
		if not cam or not hrp then return end

		local move = Vector3.zero
		if UserInputService:IsKeyDown(Enum.KeyCode.W) then move += cam.CFrame.LookVector end
		if UserInputService:IsKeyDown(Enum.KeyCode.S) then move -= cam.CFrame.LookVector end
		if UserInputService:IsKeyDown(Enum.KeyCode.A) then move -= cam.CFrame.RightVector end
		if UserInputService:IsKeyDown(Enum.KeyCode.D) then move += cam.CFrame.RightVector end
		if UserInputService:IsKeyDown(Enum.KeyCode.Space) then move += Vector3.new(0,1,0) end
		if UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) then move -= Vector3.new(0,1,0) end

		if move.Magnitude > 0 then move = move.Unit * flySpeed end
		bv.Velocity = move
		bg.CFrame = cam.CFrame
	end)
end

-- ===== ANTI RAGDOLL =====
local function setAntiRagdoll(state)
	antiRagdoll = state
	if antiRagConn then antiRagConn:Disconnect() antiRagConn=nil end
	if not antiRagdoll then return end

	antiRagConn = RunService.Heartbeat:Connect(function()
		local char = player.Character
		if not char then return end
		local hum = char:FindFirstChildOfClass("Humanoid")
		if not hum then return end

		if hum.PlatformStand then hum.PlatformStand = false end
		if hum.Sit then hum.Sit = false end

		local st = hum:GetState()
		if st == Enum.HumanoidStateType.Ragdoll
			or st == Enum.HumanoidStateType.FallingDown
			or st == Enum.HumanoidStateType.Physics then
			pcall(function() hum:ChangeState(Enum.HumanoidStateType.GettingUp) end)
		end

		for _, d in ipairs(char:GetDescendants()) do
			if d:IsA("Motor6D") and d.Enabled == false then
				d.Enabled = true
			end
		end
	end)
end

-- ===== ANTI FALL =====
local function setAntiFall(state)
	antiFall = state
	if antiFallConn then antiFallConn:Disconnect() antiFallConn=nil end
	if not antiFall then return end

	antiFallConn = RunService.Heartbeat:Connect(function()
		local char = player.Character
		if not char then return end
		local hum = char:FindFirstChildOfClass("Humanoid")
		if not hum then return end

		if hum.PlatformStand then hum.PlatformStand = false end
		if hum.Sit then hum.Sit = false end

		local st = hum:GetState()
		if st == Enum.HumanoidStateType.FallingDown
			or st == Enum.HumanoidStateType.Ragdoll
			or st == Enum.HumanoidStateType.Physics then
			pcall(function()
				hum:ChangeState(Enum.HumanoidStateType.GettingUp)
				task.defer(function()
					if antiFall and hum.Parent then
						hum:ChangeState(Enum.HumanoidStateType.Running)
					end
				end)
			end)
		end
	end)
end

-- ===== TRAINING (SafeZone) =====
local function inSafeZone()
	local zone = workspace:FindFirstChild("SafeZone")
	if not zone or not zone:IsA("BasePart") then return false end
	local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
	if not hrp then return false end
	local lp = zone.CFrame:PointToObjectSpace(hrp.Position)
	return math.abs(lp.X) <= zone.Size.X/2
		and math.abs(lp.Y) <= zone.Size.Y/2
		and math.abs(lp.Z) <= zone.Size.Z/2
end

local function setTrainingMode(state)
	trainingEnabled = state
	if trainingConn then trainingConn:Disconnect() trainingConn=nil end
	if not trainingEnabled then return end

	trainingConn = RunService.Heartbeat:Connect(function()
		local hum = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
		if not hum then return end
		if inSafeZone() and hum.Health < hum.MaxHealth then
			hum.Health = hum.MaxHealth
		end
	end)
end

-- ===== Admin: Freeze local-only =====
local function setFreeze(state)
	freezeMe = state
	if freezeConn then freezeConn:Disconnect() freezeConn=nil end
	if not freezeMe then return end

	freezeConn = RunService.Heartbeat:Connect(function()
		local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
		local hum = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
		if not hrp or not hum then return end
		hrp.AssemblyLinearVelocity = Vector3.zero
		hrp.AssemblyAngularVelocity = Vector3.zero
		hum.WalkSpeed = 0
		hum.JumpPower = 0
	end)
end

-- ===== finite reset =====
local function hookGroundReset()
	local hum = getHumanoid()
	hum.StateChanged:Connect(function(_, newState)
		if newState == Enum.HumanoidStateType.Landed
			or newState == Enum.HumanoidStateType.Running
			or newState == Enum.HumanoidStateType.RunningNoPhysics then
			usedAir = 0
		end
	end)
end
hookGroundReset()

local function refreshLeftUI()
	if infToggle then infToggle.Text = infJump and "INF JUMP: Báº¬T" or "INF JUMP: Táº®T" end
	if finToggle then finToggle.Text = finEnabled and "FINITE JUMP: Báº¬T" or "FINITE JUMP: Táº®T" end
	if finMaxLbl then finMaxLbl.Text = ("Sá» NHáº¢Y: %d"):format(finMaxAir) end
	if finBoostLbl then finBoostLbl.Text = ("Lá»°C NHáº¢Y: %d"):format(finBoost) end
end

local function refreshRightUI()
	if flyBtn then flyBtn.Text = flyEnabled and "BAY: Báº¬T" or "BAY: Táº®T" end
	if speedLbl then speedLbl.Text = ("SPEED: %d"):format(walkSpeed) end
	if flySpeedLbl then flySpeedLbl.Text = ("FLY SPEED: %d"):format(flySpeed) end
	if antiRagBtn then antiRagBtn.Text = antiRagdoll and "ANTI RAGDOLL: Báº¬T" or "ANTI RAGDOLL: Táº®T" end
	if antiFallBtn then antiFallBtn.Text = antiFall and "CHá»NG NGÃƒ: Báº¬T" or "CHá»NG NGÃƒ: Táº®T" end
	if trainingBtn then trainingBtn.Text = trainingEnabled and "TRAINING: Báº¬T" or "TRAINING: Táº®T" end
end

local function createPanels()
	-- LEFT
	leftPanel = mkUI("Frame", {
		Name="LeftPanel",
		Size=UDim2.new(0, 320, 0, 270),
		Position=UDim2.new(0, 20, 0, 20),
	}, gui)
	addWindowBar(leftPanel, "JUMP PANEL")

	infToggle = mkUI("TextButton", {
		Size=UDim2.new(1, -24, 0, 38),
		Position=UDim2.new(0, 12, 0, 52),
		TextScaled=true
	}, leftPanel)

	finToggle = mkUI("TextButton", {
		Size=UDim2.new(1, -24, 0, 38),
		Position=UDim2.new(0, 12, 0, 94),
		TextScaled=true
	}, leftPanel)

	finMaxLbl = mkUI("TextLabel", {
		Size=UDim2.new(0.55, -18, 0, 34),
		Position=UDim2.new(0, 12, 0, 140),
		TextScaled=true,
		TextXAlignment=Enum.TextXAlignment.Left
	}, leftPanel)

	local finMaxMinus = mkUI("TextButton", {
		Size=UDim2.new(0, 45, 0, 34),
		Position=UDim2.new(0.55, 0, 0, 140),
		TextScaled=true,
		Text="-"
	}, leftPanel)

	local finMaxPlus = mkUI("TextButton", {
		Size=UDim2.new(0, 45, 0, 34),
		Position=UDim2.new(0.55, 50, 0, 140),
		TextScaled=true,
		Text="+"
	}, leftPanel)

	finBoostLbl = mkUI("TextLabel", {
		Size=UDim2.new(0.55, -18, 0, 34),
		Position=UDim2.new(0, 12, 0, 182),
		TextScaled=true,
		TextXAlignment=Enum.TextXAlignment.Left
	}, leftPanel)

	local finBoostMinus = mkUI("TextButton", {
		Size=UDim2.new(0, 45, 0, 34),
		Position=UDim2.new(0.55, 0, 0, 182),
		TextScaled=true,
		Text="-"
	}, leftPanel)

	local finBoostPlus = mkUI("TextButton", {
		Size=UDim2.new(0, 45, 0, 34),
		Position=UDim2.new(0.55, 50, 0, 182),
		TextScaled=true,
		Text="+"
	}, leftPanel)

	-- RIGHT
	local rightHeight = isAdmin() and 560 or 430
	rightPanel = mkUI("Frame", {
		Name="RightPanel",
		Size=UDim2.new(0, 320, 0, rightHeight),
		Position=UDim2.new(1, -340, 0, 20),
	}, gui)
	addWindowBar(rightPanel, isAdmin() and "BAY / SPEED / ADMIN" or "BAY / SPEED / ANTI")

	flyBtn = mkUI("TextButton", {
		Size=UDim2.new(1, -24, 0, 42),
		Position=UDim2.new(0, 12, 0, 52),
		TextScaled=true
	}, rightPanel)

	speedLbl = mkUI("TextLabel", {
		Size=UDim2.new(0.55, -18, 0, 34),
		Position=UDim2.new(0, 12, 0, 104),
		TextScaled=true,
		TextXAlignment=Enum.TextXAlignment.Left
	}, rightPanel)

	local speedMinus = mkUI("TextButton", {
		Size=UDim2.new(0, 45, 0, 34),
		Position=UDim2.new(0.55, 0, 0, 104),
		TextScaled=true,
		Text="-"
	}, rightPanel)

	local speedPlus = mkUI("TextButton", {
		Size=UDim2.new(0, 45, 0, 34),
		Position=UDim2.new(0.55, 50, 0, 104),
		TextScaled=true,
		Text="+"
	}, rightPanel)

	flySpeedLbl = mkUI("TextLabel", {
		Size=UDim2.new(0.55, -18, 0, 34),
		Position=UDim2.new(0, 12, 0, 146),
		TextScaled=true,
		TextXAlignment=Enum.TextXAlignment.Left
	}, rightPanel)

	local flySpeedMinus = mkUI("TextButton", {
		Size=UDim2.new(0, 45, 0, 34),
		Position=UDim2.new(0.55, 0, 0, 146),
		TextScaled=true,
		Text="-"
	}, rightPanel)

	local flySpeedPlus = mkUI("TextButton", {
		Size=UDim2.new(0, 45, 0, 34),
		Position=UDim2.new(0.55, 50, 0, 146),
		TextScaled=true,
		Text="+"
	}, rightPanel)

	antiRagBtn = mkUI("TextButton", {
		Size=UDim2.new(1, -24, 0, 38),
		Position=UDim2.new(0, 12, 0, 190),
		TextScaled=true
	}, rightPanel)

	antiFallBtn = mkUI("TextButton", {
		Size=UDim2.new(1, -24, 0, 38),
		Position=UDim2.new(0, 12, 0, 232),
		TextScaled=true
	}, rightPanel)

	trainingBtn = mkUI("TextButton", {
		Size=UDim2.new(1, -24, 0, 38),
		Position=UDim2.new(0, 12, 0, 274),
		TextScaled=true
	}, rightPanel)

	-- ADMIN SAFE (chá»‰ admin tháº¥y)
	if isAdmin() then
		local adminFrame = mkUI("Frame", {
			Size = UDim2.new(1, -24, 0, 240),
			Position = UDim2.new(0, 12, 0, 320),
		}, rightPanel)

		mkUI("TextLabel", {
			Size = UDim2.new(1, -12, 0, 24),
			Position = UDim2.new(0, 6, 0, 6),
			TextScaled = true,
			Text = "ADMIN TOOLS (SAFE)"
		}, adminFrame)

		local tpSpawn = mkUI("TextButton", {
			Size = UDim2.new(1, -12, 0, 34),
			Position = UDim2.new(0, 6, 0, 36),
			TextScaled = true,
			Text = "TELEPORT: SPAWN"
		}, adminFrame)

		local tpSafe = mkUI("TextButton", {
			Size = UDim2.new(1, -12, 0, 34),
			Position = UDim2.new(0, 6, 0, 74),
			TextScaled = true,
			Text = "TELEPORT: SAFEZONE"
		}, adminFrame)

		local healMe = mkUI("TextButton", {
			Size = UDim2.new(0.49, -8, 0, 34),
			Position = UDim2.new(0, 6, 0, 112),
			TextScaled = true,
			Text = "HEAL ME"
		}, adminFrame)

		local resetMe = mkUI("TextButton", {
			Size = UDim2.new(0.49, -8, 0, 34),
			Position = UDim2.new(0.51, 2, 0, 112),
			TextScaled = true,
			Text = "RESET ME"
		}, adminFrame)

		local gravityBtn = mkUI("TextButton", {
			Size = UDim2.new(1, -12, 0, 34),
			Position = UDim2.new(0, 6, 0, 150),
			TextScaled = true,
			Text = "GRAVITY: BÃŒNH THÆ¯á»œNG"
		}, adminFrame)

		local freezeBtn = mkUI("TextButton", {
			Size = UDim2.new(1, -12, 0, 34),
			Position = UDim2.new(0, 6, 0, 188),
			TextScaled = true,
			Text = "FREEZE ME: Táº®T"
		}, adminFrame)

		local function tpToPart(part)
			local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
			if not hrp then return end
			hrp.CFrame = part.CFrame + Vector3.new(0, 5, 0)
		end

		tpSpawn.MouseButton1Click:Connect(function()
			local spawn = workspace:FindFirstChildOfClass("SpawnLocation")
			if not spawn then
				notify("ADMIN", "KhÃ´ng tháº¥y SpawnLocation", 2)
				return
			end
			tpToPart(spawn)
		end)

		tpSafe.MouseButton1Click:Connect(function()
			local safe = workspace:FindFirstChild("SafeZone")
			if not safe or not safe:IsA("BasePart") then
				notify("ADMIN", "KhÃ´ng tháº¥y Part tÃªn SafeZone", 2)
				return
			end
			tpToPart(safe)
		end)

		healMe.MouseButton1Click:Connect(function()
			local hum = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
			if hum then hum.Health = hum.MaxHealth end
		end)

		resetMe.MouseButton1Click:Connect(function()
			local hum = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
			if hum then hum.Health = 0 end
		end)

		local lowG = false
		local normalG = workspace.Gravity
		gravityBtn.MouseButton1Click:Connect(function()
			lowG = not lowG
			workspace.Gravity = lowG and 60 or normalG
			gravityBtn.Text = lowG and "GRAVITY: THáº¤P" or "GRAVITY: BÃŒNH THÆ¯á»œNG"
		end)

		freezeBtn.MouseButton1Click:Connect(function()
			freezeMe = not freezeMe
			if freezeMe then
				setFreeze(true)
				freezeBtn.Text = "FREEZE ME: Báº¬T"
			else
				if freezeConn then freezeConn:Disconnect() freezeConn=nil end
				local hum = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
				if hum then
					hum.WalkSpeed = walkSpeed
					hum.JumpPower = 50
				end
				freezeBtn.Text = "FREEZE ME: Táº®T"
			end
		end)
	end

	-- actions
	infToggle.MouseButton1Click:Connect(function() infJump = not infJump; refreshLeftUI() end)
	finToggle.MouseButton1Click:Connect(function() finEnabled = not finEnabled; refreshLeftUI() end)

	finMaxMinus.MouseButton1Click:Connect(function() finMaxAir = clamp(finMaxAir-1, 0, FIN_MAX_LIMIT); refreshLeftUI() end)
	finMaxPlus.MouseButton1Click:Connect(function() finMaxAir = clamp(finMaxAir+1, 0, FIN_MAX_LIMIT); refreshLeftUI() end)

	finBoostMinus.MouseButton1Click:Connect(function() finBoost = clamp(finBoost-5, 10, FIN_BOOST_LIMIT); refreshLeftUI() end)
	finBoostPlus.MouseButton1Click:Connect(function() finBoost = clamp(finBoost+5, 10, FIN_BOOST_LIMIT); refreshLeftUI() end)

	flyBtn.MouseButton1Click:Connect(function() if flyEnabled then stopFly() else startFly() end; refreshRightUI() end)

	speedMinus.MouseButton1Click:Connect(function()
		walkSpeed = clamp(walkSpeed - WALK_STEP, WALK_MIN, WALK_MAX)
		applyWalkSpeed(); refreshRightUI()
	end)
	speedPlus.MouseButton1Click:Connect(function()
		walkSpeed = clamp(walkSpeed + WALK_STEP, WALK_MIN, WALK_MAX)
		applyWalkSpeed(); refreshRightUI()
	end)

	flySpeedMinus.MouseButton1Click:Connect(function() flySpeed = clamp(flySpeed - FLY_STEP, FLY_MIN, FLY_MAX); refreshRightUI() end)
	flySpeedPlus.MouseButton1Click:Connect(function() flySpeed = clamp(flySpeed + FLY_STEP, FLY_MIN, FLY_MAX); refreshRightUI() end)

	antiRagBtn.MouseButton1Click:Connect(function() setAntiRagdoll(not antiRagdoll); refreshRightUI() end)
	antiFallBtn.MouseButton1Click:Connect(function() setAntiFall(not antiFall); refreshRightUI() end)
	trainingBtn.MouseButton1Click:Connect(function() setTrainingMode(not trainingEnabled); refreshRightUI() end)

	applyWalkSpeed()
	refreshLeftUI()
	refreshRightUI()
end

-- ===== START =====
createPanels()
notify("OK", isAdmin() and "Admin tools Ä‘Ã£ báº­t âœ…" or "GUI Ä‘Ã£ má»Ÿ âœ…", 3)

-- ===== HOTKEY =====
UserInputService.InputBegan:Connect(function(inp, gp)
	if gp then return end

	-- O: má»Ÿ láº¡i náº¿u lá»¡ báº¥m X Ä‘Ã³ng
	if inp.KeyCode == Enum.KeyCode.O then
		if leftPanel then leftPanel.Visible = true end
		if rightPanel then rightPanel.Visible = true end
	end

	-- P: áº©n/hiá»‡n 2 panel
	if inp.KeyCode == Enum.KeyCode.P and leftPanel and rightPanel then
		local v = not leftPanel.Visible
		leftPanel.Visible = v
		rightPanel.Visible = v
		return
	end

	-- Jump
	if inp.KeyCode == Enum.KeyCode.Space then
		local hum = getHumanoid()
		local hrp = getHRP()

		if (not infJump) and (not finEnabled) then
			if not isGrounded(hum) then
				local now = tick()
				if now - lastSpaceAt < 0.5 then return end
				lastSpaceAt = now
			end
			return
		end

		if infJump then
			if not isGrounded(hum) then
				local v = hrp.AssemblyLinearVelocity
				hrp.AssemblyLinearVelocity = Vector3.new(v.X, math.max(v.Y, finBoost), v.Z)
			end
			return
		end

		if finEnabled then
			if isGrounded(hum) then usedAir = 0; return end
			if usedAir >= finMaxAir then return end
			usedAir += 1
			local v = hrp.AssemblyLinearVelocity
			hrp.AssemblyLinearVelocity = Vector3.new(v.X, math.max(v.Y, finBoost), v.Z)
		end
	end
end)

-- ===== RESPAWN =====
player.CharacterAdded:Connect(function()
	stopFly()
	if antiRagConn then antiRagConn:Disconnect() antiRagConn=nil end
	if antiFallConn then antiFallConn:Disconnect() antiFallConn=nil end
	if trainingConn then trainingConn:Disconnect() trainingConn=nil end
	if freezeConn then freezeConn:Disconnect() freezeConn=nil end

	task.wait(0.1)
	applyWalkSpeed()
	if antiRagdoll then setAntiRagdoll(true) end
	if antiFall then setAntiFall(true) end
	if trainingEnabled then setTrainingMode(true) end
	if freezeMe then setFreeze(true) end

	usedAir = 0
	hookGroundReset()
end)

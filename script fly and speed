-- StarterPlayerScripts/ClientAutoGUI_ALWAYS_VISIBLE.client.lua
-- GUI LUÔN HIỆN (B) để test: Kick/Ban UI + notification
-- Cần có ServerScript (AdminAuto.server.lua) trong ServerScriptService để kick/ban hoạt động.

local Players = game:GetService("Players")
local StarterGui = game:GetService("StarterGui")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local function notify(title, text, seconds)
	pcall(function()
		StarterGui:SetCore("SendNotification", {
			Title = title or "INFO",
			Text = text or "",
			Duration = seconds or 3
		})
	end)
end

local function mk(inst, props, parent)
	local o = Instance.new(inst)
	for k,v in pairs(props) do o[k]=v end
	o.Parent = parent
	return o
end

-- Xóa GUI cũ nếu có
local old = playerGui:FindFirstChild("AdminAutoGUI")
if old then old:Destroy() end

-- Tạo GUI
local gui = mk("ScreenGui", {Name="AdminAutoGUI", ResetOnSpawn=false}, playerGui)

local panel = mk("Frame", {
	Size = UDim2.new(0, 320, 0, 230),
	Position = UDim2.new(1, -340, 0, 20),
	BackgroundTransparency = 0.15,
	Visible = true -- ✅ B: LUÔN HIỆN
}, gui)

mk("TextLabel", {
	Size = UDim2.new(1, -20, 0, 30),
	Position = UDim2.new(0, 10, 0, 10),
	BackgroundTransparency = 1,
	TextScaled = true,
	Text = "ADMIN MOD (KICK / BAN)"
}, panel)

-- Remote (server tự tạo)
local adminRem = ReplicatedStorage:WaitForChild("AdminMod")

local targetBtn = mk("TextButton", {
	Size = UDim2.new(1, -20, 0, 40),
	Position = UDim2.new(0, 10, 0, 50),
	TextScaled = true,
	Text = "CHỌN PLAYER"
}, panel)

local reasonBox = mk("TextBox", {
	Size = UDim2.new(1, -20, 0, 34),
	Position = UDim2.new(0, 10, 0, 96),
	TextScaled = true,
	PlaceholderText = "Lý do...",
	ClearTextOnFocus = false,
	Text = ""
}, panel)

local kickBtn = mk("TextButton", {
	Size = UDim2.new(0.48, -10, 0, 38),
	Position = UDim2.new(0, 10, 0, 140),
	TextScaled = true,
	Text = "KICK"
}, panel)

local banBtn = mk("TextButton", {
	Size = UDim2.new(0.48, -10, 0, 38),
	Position = UDim2.new(0.52, 0, 0, 140),
	TextScaled = true,
	Text = "BAN"
}, panel)

local unbanBtn = mk("TextButton", {
	Size = UDim2.new(1, -20, 0, 34),
	Position = UDim2.new(0, 10, 0, 184),
	TextScaled = true,
	Text = "UNBAN (TARGET)"
}, panel)

-- Picker: bấm đổi qua từng player
local selectedIndex = 0
local selectedUserId = nil

local function refreshPick()
	local list = Players:GetPlayers()
	if #list == 0 then
		targetBtn.Text = "KHÔNG CÓ PLAYER"
		selectedUserId = nil
		return
	end
	selectedIndex = (selectedIndex % #list) + 1
	local p = list[selectedIndex]
	targetBtn.Text = "TARGET: " .. p.Name
	selectedUserId = p.UserId
end

targetBtn.MouseButton1Click:Connect(function()
	refreshPick()
end)

refreshPick()

local function callAdmin(action)
	if not selectedUserId then
		notify("FAIL", "Chưa chọn player", 3)
		return
	end

	local reason = reasonBox.Text
	local ok, msg = false, ""
	pcall(function()
		ok, msg = adminRem:InvokeServer(action, selectedUserId, reason)
	end)

	notify(ok and "OK" or "FAIL", tostring(msg), 3)
end

kickBtn.MouseButton1Click:Connect(function() callAdmin("kick") end)
banBtn.MouseButton1Click:Connect(function() callAdmin("ban") end)
unbanBtn.MouseButton1Click:Connect(function() callAdmin("unban") end)

notify("OK", "GUI loaded ✅ (B: luôn hiện)", 3)
print("GUI loaded, userId =", player.UserId)
